#!/bin/bash

. "$(dirname "$0")"/init.sh

PREFIX=SHA1
if [ "$1" = "-p" ]; then
    PREFIX="$2"
    shift 2
fi

REPO="$1"
shift

[ -d "$REPO" ] || error "no such repo: '$REPO'"
[ -d "$REPO"/.git ] || error "invalid repo: '$REPO'"

set -o pipefail
git rev-list --reverse "$@" | cat -n |
awk -v p="$PREFIX" '{printf "s/%s/%s-%s/g\n", $2, p, $1}'
