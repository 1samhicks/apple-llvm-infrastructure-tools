RUN: mkrepo %t
RUN: env ct=1550000001 mkblob  %t 1
RUN: git -C %t checkout -b topic2
RUN: env ct=1550000002 mkblob  %t 2
RUN: git -C %t checkout -b topic34
RUN: env ct=1550000003 mkblob  %t 3
RUN: env ct=1550000004 mkblob  %t 4
RUN: git -C %t checkout master
RUN: env ct=1550000005 mkmerge %t 5 topic2
RUN: env ct=1550000006 mkblob  %t 6
RUN: env ct=1550000007 mkmerge %t 7 topic34
RUN: number-commits -p C %t master --date-order >%t.map

RUN: git -C %t apple-llvm count-merged \
RUN:   | apply-commit-numbers %t.map | check-diff %s CHECK %t
RUN: git -C %t apple-llvm count-merged HEAD \
RUN:   | apply-commit-numbers %t.map | check-diff %s CHECK %t
RUN: mkdir %t/abc
RUN: git -C %t/abc apple-llvm count-merged \
RUN:   | apply-commit-numbers %t.map | check-diff %s CHECK %t
CHECK: C-7 2
CHECK: C-6 0
CHECK: C-5 1
CHECK: C-1 0

RUN: git -C %t apple-llvm count-merged --min=1 \
RUN:   | apply-commit-numbers %t.map | check-diff %s MIN-1 %t
RUN: git -C %t apple-llvm count-merged --min=2 \
RUN:   | apply-commit-numbers %t.map | check-diff %s MIN-2 %t
RUN: git -C %t apple-llvm count-merged --min=3 \
RUN:   | check-empty
MIN-1: C-7 2
MIN-1: C-5 1
MIN-2: C-7 2
